<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Explorador de Regiones Pokemon</title>
    <link rel="stylesheet" href="styles/styles.css">
</head>
<body>
    <div class="main">
                    <h1>Explorador de Regiones Pokemon</h1>
        
        <div id="pokedex">
            <!-- IMAGEN RESPONSIVA - No necesita <map>, usa coordenadas din√°micas -->
            <img src="images/map.png" alt="Mapa del Mundo Pokemon" id="pokemon-map-image">
        </div>

        <!-- Secciones de visualizaci√≥n para datos de regi√≥n y Pokemon -->
        <div id="content-area">
            <!-- Indicador de carga -->
            <div id="loading" class="hidden">
                <p>Cargando...</p>
            </div>

            <!-- Mensajes de error -->
            <div id="error-message" class="hidden error">
                <p id="error-text"></p>
            </div>

            <!-- Visualizaci√≥n de informaci√≥n de regi√≥n -->
            <div id="region-info" class="hidden">
                <h2 id="region-title"></h2>
                <p id="region-description"></p>
                <div id="region-stats"></div>
            </div>

            <!-- Contenedor de Ubicaciones/√Åreas con b√∫squeda -->
            <div id="locations-container" class="hidden">
                <h3>Ubicaciones Disponibles en <span id="selected-region"></span></h3>
                
                <!-- Barra de b√∫squeda para ubicaciones -->
                <div id="location-search-container">
                    <input type="text" id="location-search" placeholder="Buscar ubicaciones..." />
                    <button id="search-clear">√ó</button>
                </div>
                
                <!-- Conteo de ubicaciones e informaci√≥n de paginaci√≥n -->
                <div id="location-info">
                    <p>Mostrando <span id="locations-shown">0</span> de <span id="locations-total">0</span> ubicaciones</p>
                    <button id="load-more-locations" class="hidden">Cargar M√°s Ubicaciones</button>
                </div>
                
                <div id="locations-grid"></div>
            </div>

            <!-- √Årea de visualizaci√≥n de Pokemon con colores de tipos -->
            <div id="pokemon-container" class="hidden">
                <h3 id="location-title"></h3>
                
                <!-- Tipos de Pokemon en esta ubicaci√≥n -->
                <div id="pokemon-types-container">
                    <h4>üé® Tipos de Pokemon en esta √°rea:</h4>
                    <div id="pokemon-types-grid"></div>
                </div>
                
                <!-- Lista de Pokemon -->
                <div id="pokemon-list-container">
                    <h4>üéØ Pokemon disponibles:</h4>
                    <div id="pokemon-grid"></div>
                </div>
                
                <div id="no-pokemon-message" class="hidden">
                    <p>üòÖ Ups, no hay pokemones disponibles en esta ubicaci√≥n</p>
                </div>
            </div>

            <!-- Bot√≥n de regreso -->
            <div id="navigation" class="hidden">
                <button id="back-button">‚¨ÖÔ∏è Volver</button>
                <button id="home-button">üè† Inicio</button>
            </div>
        </div>

        <!-- Popup Modal de Ubicaci√≥n Pokemon -->
        <div id="pokemon-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modal-location-title">Cargando ubicaci√≥n...</h2>
                    <button class="modal-close" onclick="closePokemonModal()">&times;</button>
                </div>
                
                <div class="modal-body">
                    <!-- Indicador de carga para modal -->
                    <div id="modal-loading" class="modal-loading">
                        <div class="pokeball-loader">
                            <div class="pokeball-center"></div>
                        </div>
                        <div class="sparkle"></div>
                        <div class="sparkle"></div>
                        <div class="sparkle"></div>
                        <div class="sparkle"></div>
                        <p class="loading-text">Cargando Pokemon...</p>
                    </div>
                    
                    <!-- Secci√≥n de tipos de Pokemon -->
                    <div id="modal-pokemon-types" class="hidden">
                        <h3>Tipos de Pokemon en esta ubicaci√≥n</h3>
                        <div id="modal-types-grid" class="types-grid"></div>
                    </div>
                    
                    <!-- Secci√≥n de lista de Pokemon -->
                    <div id="modal-pokemon-list" class="hidden">
                        <h3>Pokemon disponibles</h3>
                        <div id="modal-pokemon-grid" class="pokemon-grid"></div>
                        <div id="modal-load-more-pokemon" class="hidden">
                            <button onclick="loadMorePokemon()">Cargar m√°s Pokemon</button>
                        </div>
                    </div>
                    
                    <!-- Mensaje de no hay Pokemon -->
                    <div id="modal-no-pokemon" class="hidden">
                        <p>No hay Pokemon disponibles en esta ubicaci√≥n</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SISTEMA DE COORDENADAS DIN√ÅMICO -->
        <script>
            // COORDENADAS DE REGIONES (imagen original 4561x2670)
            const REGIONS = {
                kalos: { coords: [639,1058,1258,1336], name: "Kalos" },
                orre: { coords: [870,1526,1384,1766], name: "Orre" },
                paldea: { coords: [148,1515,722,1902], name: "Paldea" },
                unova: { coords: [1479,959,2189,1237], name: "Unova" },
                galar: { coords: [897,541,1501,872], name: "Galar" },
                fiore: { coords: [1927,693,2402,857], name: "Fiore" },
                alola: { coords: [851,2104,1539,2477], name: "Alola" },
                almia: { coords: [2463,214,2923,419], name: "Almia" },
                sinnoh: { coords: [2984,126,3577,632], name: "Sinnoh" },
                johto: { coords: [3250,1119,3824,1526], name: "Johto" },
                ferrum: { coords: [3744,651,4344,940], name: "Ferrum" },
                kanto: { coords: [3919,1142,4474,1378], name: "Kanto" },
                hoenn: { coords: [2315,1899,3181,2359], name: "Hoenn" },
                oblivia: { coords: [3364,2287,3991,2530], name: "Oblivia" }
            };

            const ORIGINAL_WIDTH = 4561;
            const ORIGINAL_HEIGHT = 2670;

            // Inicializar sistema de coordenadas din√°mico
            function initDynamicMap() {
                const img = document.getElementById('pokemon-map-image');
                if (!img) return;

                img.addEventListener('click', handleMapClick);
                img.style.cursor = 'crosshair';
                
                console.log('üó∫Ô∏è Dynamic map system initialized!');
            }

            function handleMapClick(event) {
                const img = event.target;
                const rect = img.getBoundingClientRect();
                
                // Obtener posici√≥n del clic relativa a la imagen
                const clickX = event.clientX - rect.left;
                const clickY = event.clientY - rect.top;
                
                // Calcular factores de escala
                const scaleX = ORIGINAL_WIDTH / img.offsetWidth;
                const scaleY = ORIGINAL_HEIGHT / img.offsetHeight;
                
                // Convertir a coordenadas originales
                const originalX = Math.round(clickX * scaleX);
                const originalY = Math.round(clickY * scaleY);
                
                console.log(`üéØ Map clicked: (${originalX}, ${originalY})`);
                
                // Encontrar qu√© regi√≥n fue clickeada
                const clickedRegion = findRegionByCoordinates(originalX, originalY);
                
                if (clickedRegion) {
                    const regionKey = Object.keys(REGIONS).find(key => 
                        REGIONS[key].name === clickedRegion
                    );
                    console.log(`üåç Region detected: ${clickedRegion} (${regionKey})`);
                    
                    // DEBUG: Verificar qu√© funciones est√°n disponibles
                    console.log('üîç Function availability check:');
                    console.log('- inlineSelectRegion:', typeof window.inlineSelectRegion);
                    console.log('- selectRegion:', typeof window.selectRegion);
                    console.log('- debugRegionClick:', typeof window.debugRegionClick);
                    
                    // Llamar funci√≥n inline primero (previene conflictos con script.js)
                    if (typeof window.inlineSelectRegion === 'function') {
                        console.log('üöÄ Calling window.inlineSelectRegion...');
                        window.inlineSelectRegion(regionKey);
                    } else if (typeof window.selectRegion === 'function') {
                        console.log('üöÄ Calling window.selectRegion...');
                        window.selectRegion(regionKey);
                    } else if (typeof window.debugRegionClick === 'function') {
                        console.log('üöÄ Calling window.debugRegionClick...');
                        window.debugRegionClick(regionKey);
                    } else {
                        console.log('‚ö†Ô∏è No region functions available');
                        alert(`Region detected: ${regionKey}\nBut no functions available`);
                    }
                } else {
                    console.log('üìç No region found at coordinates:', originalX, originalY);
                }
            }

            function findRegionByCoordinates(x, y) {
                for (const [key, region] of Object.entries(REGIONS)) {
                    const [x1, y1, x2, y2] = region.coords;
                    if (x >= x1 && x <= x2 && y >= y1 && y <= y2) {
                        return region.name;
                    }
                }
                return null;
            }

            // Inicializar cuando la p√°gina carga
            window.addEventListener('load', function() {
                setTimeout(initDynamicMap, 100);
                
                // Cerrar modal al hacer clic fuera
                const modal = document.getElementById('pokemon-modal');
                if (modal) {
                    modal.addEventListener('click', function(e) {
                        if (e.target === modal) {
                            closePokemonModal();
                        }
                    });
                }
                
                // Cerrar modal con tecla Escape
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape') {
                        closePokemonModal();
                    }
                });
            });
            
            // FUNCI√ìN INLINE DE REGI√ìN POKEMON - funcionalidad principal de la app (renombrada para evitar conflictos)
            window.inlineSelectRegion = async function(regionName) {
                console.log('INLINE: Loading region ' + regionName);
                
                // Mostrar indicador de carga
                const loadingEl = document.getElementById('loading');
                const locationsContainer = document.getElementById('locations-container');
                const selectedRegionSpan = document.getElementById('selected-region');
                const regionInfo = document.getElementById('region-info');
                const regionTitle = document.getElementById('region-title');
                const errorMessage = document.getElementById('error-message');
                const errorText = document.getElementById('error-text');
                
                // Ocultar todos los contenedores primero
                if (regionInfo) regionInfo.classList.add('hidden');
                if (locationsContainer) locationsContainer.classList.add('hidden');
                if (errorMessage) errorMessage.classList.add('hidden');
                
                // Mostrar carga
                if (loadingEl) {
                    loadingEl.classList.remove('hidden');
                    loadingEl.style.display = 'block';
                    console.log('Loading indicator shown');
                }
                
                // Actualizar t√≠tulo de regi√≥n y regi√≥n seleccionada
                if (regionTitle) regionTitle.textContent = regionName.charAt(0).toUpperCase() + regionName.slice(1);
                if (selectedRegionSpan) selectedRegionSpan.textContent = regionName.charAt(0).toUpperCase() + regionName.slice(1);
                
                try {
                    // Hacer llamada real a la API usando la funci√≥n existente
                    console.log('üîç Calling getUniversalRegionInfo for:', regionName);
                    
                    let regionData;
                    
                    // Intentar obtener la funci√≥n del scope global primero
                    let getUniversalRegionInfo = window.getUniversalRegionInfo;
                    
                    if (typeof getUniversalRegionInfo !== 'function') {
                        console.log('‚ö†Ô∏è Global getUniversalRegionInfo not available, making direct API call...');
                        
                        // Hacer llamada directa a la API de Pokemon
                        const response = await fetch('https://pokeapi.co/api/v2/region/' + regionName);
                        if (!response.ok) throw new Error('Region not found: ' + regionName);
                        const apiResponse = await response.json();
                        
                        // Extraer ubicaciones de la respuesta
                        const validLocations = apiResponse.locations.map(location => {
                            const locationId = location.url.split('/').filter(Boolean).pop();
                            return {
                                name: location.name,
                                id: locationId,
                                url: location.url
                            };
                        });
                        
                        regionData = {
                            areas: {
                                region: regionName,
                                locationCount: validLocations.length,
                                validLocations: validLocations
                            },
                            pokemon: null
                        };
                        
                        console.log('üìç Direct API response:', regionData);
                    } else {
                        regionData = await getUniversalRegionInfo(regionName);
                        console.log('üìç API response:', regionData);
                    }
                    
                    // Ocultar carga
                    if (loadingEl) loadingEl.classList.add('hidden');
                    
                    if (regionData && regionData.areas && regionData.areas.validLocations && regionData.areas.validLocations.length > 0) {
                        // Mostrar contenedor de ubicaciones
                        if (locationsContainer) {
                            locationsContainer.classList.remove('hidden');
                            console.log('‚úÖ Locations container shown');
                        }
                        
                        // Poblar con datos reales de la API (primeras 10 ubicaciones como se solicit√≥)
                        const locationsGrid = document.getElementById('locations-grid');
                        const locations = regionData.areas.validLocations.slice(0, 10);
                        
                        if (locationsGrid) {
                            let locationsHTML = '';
                            locations.forEach(location => {
                                locationsHTML += 
                                    '<div class="location-item" onclick="inlineSelectLocation(\'' + regionName + '\', \'' + location.name + '\')">' +
                                        '<h4>' + location.name.replace(/-/g, ' ').toUpperCase() + '</h4>' +
                                        '<p>Ubicaci√≥n en ' + regionName + ' - Click para explorar Pokemon</p>' +
                                    '</div>';
                            });
                            locationsGrid.innerHTML = locationsHTML;
                            
                            // Actualizar contadores
                            const locationsShownSpan = document.getElementById('locations-shown');
                            const locationsTotalSpan = document.getElementById('locations-total');
                            const loadMoreButton = document.getElementById('load-more-locations');
                            
                            if (locationsShownSpan) locationsShownSpan.textContent = locations.length;
                            if (locationsTotalSpan) locationsTotalSpan.textContent = regionData.areas.validLocations.length;
                            
                            // Mostrar bot√≥n de cargar m√°s si hay m√°s ubicaciones
                            if (loadMoreButton && regionData.areas.validLocations.length > 10) {
                                loadMoreButton.classList.remove('hidden');
                                
                                // Almacenar datos de regi√≥n para funcionalidad de cargar m√°s
                                window.currentRegionData = regionData;
                                window.currentRegionName = regionName;
                                window.currentLocationsShown = 10;
                                
                                // Agregar manejador de clic para bot√≥n de cargar m√°s
                                loadMoreButton.onclick = function() {
                                    inlineLoadMoreLocations();
                                };
                            }
                            
                            console.log('‚úÖ Real locations loaded:', locations.length, 'of', regionData.areas.validLocations.length);
                        }
                    } else {
                        // No se encontraron ubicaciones
                        if (errorMessage && errorText) {
                            errorText.textContent = 'No se encontraron ubicaciones para la regi√≥n ' + regionName;
                            errorMessage.classList.remove('hidden');
                        }
                        console.log('‚ùå No locations found for region:', regionName);
                    }
                    
                } catch (error) {
                    console.error('‚ùå Error loading region data:', error);
                    
                    // Ocultar carga y mostrar error
                    if (loadingEl) loadingEl.classList.add('hidden');
                    if (errorMessage && errorText) {
                        errorText.textContent = 'Error cargando regi√≥n ' + regionName + ': ' + error.message;
                        errorMessage.classList.remove('hidden');
                    }
                }
            };
            
            // FUNCI√ìN INLINE DE SELECCI√ìN DE UBICACI√ìN (renombrada para evitar conflictos)
            window.inlineSelectLocation = async function(regionName, locationName) {
                console.log('üìç INLINE: Loading location ' + locationName + ' in ' + regionName);
                
                // Mostrar modal
                showPokemonModal(locationName, regionName);
                
                // Start loading Pokemon data
                await loadPokemonForLocation(regionName, locationName);
            };
            
            // SHOW POKEMON MODAL
            window.showPokemonModal = function(locationName, regionName) {
                console.log('üéØ MODAL: Attempting to show modal for', locationName, regionName);
                
                const modal = document.getElementById('pokemon-modal');
                const modalTitle = document.getElementById('modal-location-title');
                const modalLoading = document.getElementById('modal-loading');
                const modalTypes = document.getElementById('modal-pokemon-types');
                const modalList = document.getElementById('modal-pokemon-list');
                const modalNoPokemon = document.getElementById('modal-no-pokemon');
                
                console.log('üéØ MODAL: Elements found:', {
                    modal: !!modal,
                    modalTitle: !!modalTitle,
                    modalLoading: !!modalLoading
                });
                
                if (modal && modalTitle) {
                    // Set title
                    const formattedLocation = locationName.replace(/-/g, ' ').toUpperCase();
                    const formattedRegion = regionName.charAt(0).toUpperCase() + regionName.slice(1);
                    modalTitle.textContent = `${formattedLocation} - ${formattedRegion}`;
                    
                    console.log('üéØ MODAL: Title set to:', modalTitle.textContent);
                    
                    // Reset modal state - FIRST remove hidden, THEN add show
                    if (modalLoading) modalLoading.classList.remove('hidden');
                    if (modalTypes) modalTypes.classList.add('hidden');
                    if (modalList) modalList.classList.add('hidden');
                    if (modalNoPokemon) modalNoPokemon.classList.add('hidden');
                    
                    // Show modal - IMPORTANT: Remove hidden FIRST
                    console.log('üéØ MODAL: Before show - classes:', modal.className);
                    modal.classList.remove('hidden');  // Remove hidden FIRST
                    modal.classList.add('show');       // Then add show
                    
                    // Force styles as backup with proper centering
                    modal.style.cssText = `
                        display: flex !important;
                        align-items: center !important;
                        justify-content: center !important;
                        position: fixed !important;
                        top: 0 !important;
                        left: 0 !important;
                        width: 100vw !important;
                        height: 100vh !important;
                        z-index: 1000 !important;
                        background-color: rgba(0, 0, 0, 0.8) !important;
                        opacity: 1 !important;
                    `;
                    
                    console.log('üéØ MODAL: After show - classes:', modal.className);
                    console.log('üéØ MODAL: Inline styles applied:', modal.style.cssText);
                    
                    // Prevent body scrolling
                    document.body.style.overflow = 'hidden';
                    
                    console.log('‚úÖ MODAL: Modal should be visible now!');
                } else {
                    console.error('‚ùå MODAL: Missing required elements!', {
                        modal: !!modal,
                        modalTitle: !!modalTitle
                    });
                }
            };
            
            // CLOSE POKEMON MODAL
            window.closePokemonModal = function() {
                console.log('üéØ MODAL: Closing modal...');
                const modal = document.getElementById('pokemon-modal');
                if (modal) {
                    modal.classList.remove('show');
                    modal.classList.add('hidden');
                    
                    // Clear inline styles
                    modal.style.cssText = '';
                    
                    // Restore body scrolling
                    document.body.style.overflow = '';
                    
                    console.log('‚úÖ MODAL: Modal closed');
                }
            };
            
            // LOAD POKEMON FOR LOCATION
            window.loadPokemonForLocation = async function(regionName, locationName) {
                const modalLoading = document.getElementById('modal-loading');
                const modalTypes = document.getElementById('modal-pokemon-types');
                const modalList = document.getElementById('modal-pokemon-list');
                const modalNoPokemon = document.getElementById('modal-no-pokemon');
                const typesGrid = document.getElementById('modal-types-grid');
                const pokemonGrid = document.getElementById('modal-pokemon-grid');
                
                try {
                    console.log('üîç Loading Pokemon for location:', locationName);
                    
                    // First try to get the location details to find areas
                    let locationData;
                    let pokemonEncounters = [];
                    
                    // Try different approaches to get Pokemon data
                    const attempts = [
                        // 1. Try direct location-area call
                        async () => {
                            const response = await fetch(`https://pokeapi.co/api/v2/location-area/${locationName}`);
                            if (response.ok) {
                                return await response.json();
                            }
                            throw new Error('Direct location-area failed');
                        },
                        
                        // 2. Try with -area suffix
                        async () => {
                            const response = await fetch(`https://pokeapi.co/api/v2/location-area/${locationName}-area`);
                            if (response.ok) {
                                return await response.json();
                            }
                            throw new Error('Location with -area suffix failed');
                        },
                        
                        // 3. Try getting location first, then areas
                        async () => {
                            const locationResponse = await fetch(`https://pokeapi.co/api/v2/location/${locationName}`);
                            if (!locationResponse.ok) throw new Error('Location not found');
                            
                            const location = await locationResponse.json();
                            console.log('üìç Location details:', location);
                            
                            // Get areas from this location
                            if (location.areas && location.areas.length > 0) {
                                // Try the first area
                                const firstArea = location.areas[0];
                                const areaResponse = await fetch(firstArea.url);
                                if (areaResponse.ok) {
                                    return await areaResponse.json();
                                }
                            }
                            throw new Error('No areas found in location');
                        },
                        
                        // 4. Try common area suffixes
                        async () => {
                            const suffixes = ['-1f', '-b1f', '-outside', '-inside', '-entrance'];
                            for (const suffix of suffixes) {
                                try {
                                    const response = await fetch(`https://pokeapi.co/api/v2/location-area/${locationName}${suffix}`);
                                    if (response.ok) {
                                        return await response.json();
                                    }
                                } catch (e) {
                                    // Continue to next suffix
                                }
                            }
                            throw new Error('No common suffixes worked');
                        }
                    ];
                    
                    // Try each approach
                    let success = false;
                    for (let i = 0; i < attempts.length; i++) {
                        try {
                            console.log(`üîÑ Trying approach ${i + 1}/4 for location: ${locationName}`);
                            locationData = await attempts[i]();
                            pokemonEncounters = locationData.pokemon_encounters || [];
                            console.log(`‚úÖ Approach ${i + 1} successful! Found ${pokemonEncounters.length} Pokemon encounters`);
                            success = true;
                            break;
                        } catch (error) {
                            console.log(`‚ùå Approach ${i + 1} failed:`, error.message);
                        }
                    }
                    
                    if (!success) {
                        throw new Error(`No se pudieron cargar los Pokemon para ${locationName}. Es posible que esta ubicaci√≥n no tenga Pokemon disponibles en la API.`);
                    }
                    
                    if (pokemonEncounters.length === 0) {
                        // No Pokemon found
                        if (modalLoading) modalLoading.classList.add('hidden');
                        if (modalNoPokemon) {
                            modalNoPokemon.innerHTML = '<p>No hay Pokemon disponibles en esta ubicaci√≥n seg√∫n la API de Pokemon.</p>';
                            modalNoPokemon.classList.remove('hidden');
                        }
                        return;
                    }
                    
                    // Get first 12 Pokemon (for performance)
                    const limitedEncounters = pokemonEncounters.slice(0, 12);
                    const pokemonData = [];
                    const allTypes = new Set();
                    
                    // Fetch individual Pokemon data
                    console.log(`üîç Loading details for ${limitedEncounters.length} Pokemon...`);
                    for (const encounter of limitedEncounters) {
                        try {
                            const pokemonResponse = await fetch(encounter.pokemon.url);
                            if (pokemonResponse.ok) {
                                const pokemon = await pokemonResponse.json();
                                pokemonData.push(pokemon);
                                
                                // Collect types
                                pokemon.types.forEach(type => allTypes.add(type.type.name));
                            }
                        } catch (error) {
                            console.log('‚ö†Ô∏è Error loading pokemon:', encounter.pokemon.name, error);
                        }
                    }
                    
                    // Hide loading
                    if (modalLoading) modalLoading.classList.add('hidden');
                    
                    // Show types
                    if (typesGrid && allTypes.size > 0) {
                        let typesHTML = '';
                        allTypes.forEach(type => {
                            typesHTML += `<span class="type-badge type-${type}">${type}</span>`;
                        });
                        typesGrid.innerHTML = typesHTML;
                        if (modalTypes) modalTypes.classList.remove('hidden');
                    }
                    
                    // Show Pokemon
                    if (pokemonGrid && pokemonData.length > 0) {
                        let pokemonHTML = '';
                        pokemonData.forEach((pokemon, index) => {
                            // Try to get animated sprite (GIF) first, fallback to static
                            const animatedSprite = pokemon.sprites.versions?.['generation-v']?.['black-white']?.animated?.front_default;
                            const staticSprite = pokemon.sprites.front_default;
                            const sprite = animatedSprite || staticSprite || 'https://via.placeholder.com/96x96?text=?';
                            
                            const types = pokemon.types.map(t => t.type.name).join(', ');
                            const typesList = pokemon.types.map(t => `<span class="type-badge type-${t.type.name}">${t.type.name}</span>`).join(' ');
                            
                            // Calculate stats for bars (normalized to 0-100)
                            const stats = pokemon.stats || [];
                            const hp = stats.find(s => s.stat.name === 'hp')?.base_stat || 0;
                            const attack = stats.find(s => s.stat.name === 'attack')?.base_stat || 0;
                            const defense = stats.find(s => s.stat.name === 'defense')?.base_stat || 0;
                            const speed = stats.find(s => s.stat.name === 'speed')?.base_stat || 0;
                            
                            // Normalize stats to percentage (max typical stat is around 180)
                            const hpPercent = Math.min((hp / 150) * 100, 100);
                            const attackPercent = Math.min((attack / 150) * 100, 100);
                            const defensePercent = Math.min((defense / 150) * 100, 100);
                            const speedPercent = Math.min((speed / 150) * 100, 100);
                            
                            // Random chance for shiny effect (5% chance)
                            const isShiny = Math.random() < 0.05;
                            const shinyClass = isShiny ? 'shiny' : '';
                            
                            pokemonHTML += `
                                <div class="pokemon-item ${shinyClass}" style="animation-delay: ${index * 0.1}s">
                                    <img src="${sprite}" alt="${pokemon.name}" class="pokemon-sprite" 
                                         onerror="this.src='${staticSprite}'" loading="lazy">
                                    <h4>${pokemon.name}${isShiny ? ' ‚ú®' : ''}</h4>
                                    <div class="pokemon-types">${typesList}</div>
                                    <div class="pokemon-stats">
                                        <div class="stat-bar">
                                            <div class="stat-label">HP <span class="stat-value">${hp}</span></div>
                                            <div class="stat-bar-bg">
                                                <div class="stat-bar-fill" style="--width: ${hpPercent}%; width: 0%;"></div>
                                            </div>
                                        </div>
                                        <div class="stat-bar">
                                            <div class="stat-label">ATK <span class="stat-value">${attack}</span></div>
                                            <div class="stat-bar-bg">
                                                <div class="stat-bar-fill" style="--width: ${attackPercent}%; width: 0%;"></div>
                                            </div>
                                        </div>
                                        <div class="stat-bar">
                                            <div class="stat-label">DEF <span class="stat-value">${defense}</span></div>
                                            <div class="stat-bar-bg">
                                                <div class="stat-bar-fill" style="--width: ${defensePercent}%; width: 0%;"></div>
                                            </div>
                                        </div>
                                        <div class="stat-bar">
                                            <div class="stat-label">SPD <span class="stat-value">${speed}</span></div>
                                            <div class="stat-bar-bg">
                                                <div class="stat-bar-fill" style="--width: ${speedPercent}%; width: 0%;"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <p style="font-size: 0.8em; color: #95a5a6;">
                                        üìè ${pokemon.height / 10}m ‚Ä¢ ‚öñÔ∏è ${pokemon.weight / 10}kg
                                    </p>
                                </div>
                            `;
                        });
                        pokemonGrid.innerHTML = pokemonHTML;
                        
                        // Animate stat bars after a short delay
                        setTimeout(() => {
                            const statBars = document.querySelectorAll('.stat-bar-fill');
                            statBars.forEach(bar => {
                                const targetWidth = bar.style.getPropertyValue('--width');
                                bar.style.width = targetWidth;
                            });
                        }, 500);
                        
                        if (modalList) modalList.classList.remove('hidden');
                    }
                    
                    console.log('‚úÖ Pokemon loaded successfully:', pokemonData.length, 'Pokemon found with', allTypes.size, 'different types');
                    
                } catch (error) {
                    console.error('‚ùå Error loading Pokemon data:', error);
                    
                    // Hide loading and show error
                    if (modalLoading) modalLoading.classList.add('hidden');
                    if (modalNoPokemon) {
                        modalNoPokemon.innerHTML = '<p>' + error.message + '</p>';
                        modalNoPokemon.classList.remove('hidden');
                    }
                }
            };
            
            // TEST MODAL FUNCTION - for debugging
            window.testModal = function() {
                console.log('üß™ TEST: Testing modal display...');
                const modal = document.getElementById('pokemon-modal');
                if (modal) {
                    modal.classList.remove('hidden');
                    modal.classList.add('show');
                    modal.style.display = 'flex';
                    modal.style.alignItems = 'center';
                    modal.style.justifyContent = 'center';
                    console.log('üß™ TEST: Modal classes:', modal.className);
                    console.log('üß™ TEST: Modal style:', modal.style.cssText);
                } else {
                    console.error('üß™ TEST: Modal element not found!');
                }
            };
            
            // EMERGENCY CLOSE - if you're stuck with invisible modal
            window.emergencyCloseModal = function() {
                console.log('üö® EMERGENCY: Force closing modal...');
                const modal = document.getElementById('pokemon-modal');
                if (modal) {
                    modal.style.display = 'none';
                    modal.style.cssText = '';
                    modal.className = 'modal hidden';
                    document.body.style.overflow = '';
                    console.log('‚úÖ EMERGENCY: Modal force closed');
                } else {
                    console.error('üö® EMERGENCY: Modal not found');
                }
            };
            
            // INLINE LOAD MORE LOCATIONS FUNCTION
            window.inlineLoadMoreLocations = function() {
                console.log('üìç INLINE: Loading more locations...');
                
                if (!window.currentRegionData || !window.currentRegionName) {
                    console.log('‚ùå No region data available for load more');
                    return;
                }
                
                const locationsGrid = document.getElementById('locations-grid');
                const locationsShownSpan = document.getElementById('locations-shown');
                const loadMoreButton = document.getElementById('load-more-locations');
                
                if (!locationsGrid) {
                    console.log('‚ùå Locations grid not found');
                    return;
                }
                
                // Load next 10 locations
                const currentShown = window.currentLocationsShown || 10;
                const nextBatch = window.currentRegionData.areas.validLocations.slice(currentShown, currentShown + 10);
                const regionName = window.currentRegionName;
                
                if (nextBatch.length > 0) {
                    // Append new locations to existing content
                    let newLocationsHTML = '';
                    nextBatch.forEach(location => {
                        const locationName = location.name.replace(/-/g, ' ').toUpperCase();
                        const regionNameCap = regionName.charAt(0).toUpperCase() + regionName.slice(1);
                        newLocationsHTML += 
                            `<div class="location-item" onclick="inlineSelectLocation('${regionName}', '${location.name}')">` +
                                `<h4>${locationName}</h4>` +
                                `<p>Ubicaci√≥n en ${regionNameCap} - Click para explorar Pokemon</p>` +
                            `</div>`;
                    });
                    
                    // Append to existing content
                    locationsGrid.innerHTML += newLocationsHTML;
                    
                    // Update counters
                    const newTotal = currentShown + nextBatch.length;
                    window.currentLocationsShown = newTotal;
                    if (locationsShownSpan) locationsShownSpan.textContent = newTotal;
                    
                    console.log('‚úÖ Loaded ' + nextBatch.length + ' more locations. Total shown: ' + newTotal);
                    
                    // Hide load more button if we've loaded all locations
                    if (newTotal >= window.currentRegionData.areas.validLocations.length) {
                        if (loadMoreButton) {
                            loadMoreButton.classList.add('hidden');
                            console.log('‚úÖ All locations loaded, hiding load more button');
                        }
                    }
                } else {
                    console.log('‚úÖ No more locations to load');
                    if (loadMoreButton) loadMoreButton.classList.add('hidden');
                }
            };

            // INLINE DEBUG FUNCTION - bypasses caching
            window.debugRegionClick = function(regionName) {
                console.log(`üî• INLINE DEBUG FUNCTION: ${regionName}`);
                
                // Show immediate alert
                alert(`CLICKED: ${regionName.toUpperCase()}`);
                
                // Check if elements exist
                const loadingEl = document.getElementById('loading');
                const regionTitle = document.getElementById('region-title');
                
                console.log('üîç INLINE DEBUG - Elements check:');
                console.log('- loading:', loadingEl);
                console.log('- region-title:', regionTitle);
                
                if (loadingEl) {
                    // Remove hidden class first
                    loadingEl.classList.remove('hidden');
                    
                    // Apply strong styles
                    loadingEl.style.cssText = `
                        display: block !important;
                        background-color: red !important;
                        color: white !important;
                        font-size: 30px !important;
                        padding: 50px !important;
                        text-align: center !important;
                        position: fixed !important;
                        top: 50% !important;
                        left: 50% !important;
                        transform: translate(-50%, -50%) !important;
                        z-index: 9999 !important;
                        border: 5px solid yellow !important;
                        width: 400px !important;
                        height: 200px !important;
                    `;
                    
                    loadingEl.innerHTML = '<h1 style="margin: 0; color: white;">CLICKED: ' + regionName.toUpperCase() + '</h1>';
                    console.log('‚úÖ INLINE: Loading modified with maximum visibility');
                } else {
                    console.log('‚ùå INLINE: Loading element not found');
                    alert('‚ùå Loading element not found!');
                }
            };
        </script>
        
        <!-- Scripts externos con prevenci√≥n de cach√© -->
        <script src="config/config.js?v=4"></script>
        <script src="scripts/script.js?v=4"></script>
        
    </div>
</body>
</html>
